[env:ttgo-t-display]
platform = espressif32@6.4.0
board = esp32dev
framework = arduino

; TTGO T-Display ESP32 with 16MB flash configuration
; Use the same partition table as Arduino IDE build scripts
board_build.partitions = app3M_fat9M_16MB.csv
board_build.flash_size = 16MB
board_build.f_cpu = 240000000L
board_build.f_flash = 80000000L
board_build.flash_mode = qio

; Source directory configuration - use root directory for compatibility with Arduino IDE
src_dir = .
src_filter = 
    +<*.ino>
    +<*.cpp>
    +<*.h>
    -<build/>
    -<data/>
    -<archive/>
    -<test/>
    -<.vscode/>

; Upload settings
upload_speed = 921600
monitor_speed = 115200
monitor_filters = esp32_exception_decoder

; Build flags for TTGO T-Display
build_flags = 
    -DBOARD_HAS_PSRAM
    -DARDUINO_TTGO_T_Display
    -DUSER_SETUP_LOADED=1
    -DST7789_DRIVER=1
    -DTFT_WIDTH=135
    -DTFT_HEIGHT=240
    -DTFT_MISO=-1
    -DTFT_MOSI=19
    -DTFT_SCLK=18
    -DTFT_CS=5
    -DTFT_DC=16
    -DTFT_RST=23
    -DTFT_BL=4
    -DLOAD_GLCD=1
    -DLOAD_FONT2=1
    -DLOAD_FONT4=1
    -DLOAD_FONT6=1
    -DLOAD_FONT7=1
    -DLOAD_FONT8=1
    -DLOAD_GFXFF=1
    -DSMOOTH_FONT=1
    -DSPI_FREQUENCY=40000000
    -DSPI_READ_FREQUENCY=20000000

; Required libraries
lib_deps = 
    bblanchon/ArduinoJson@^6.21.3
    bodmer/TFT_eSPI@^2.5.43
    madhephaestus/ESP32Servo@^1.1.1
    arduino-libraries/NTPClient@^3.2.1

; Optional: Different environments for different upload methods
[env:ttgo-t-display-ota]
extends = env:ttgo-t-display
upload_protocol = espota
upload_port = 192.168.250.125
upload_flags = 
    --port=80
    --auth=

; Serial upload environment (when WiFi is not available)
[env:ttgo-t-display-serial]
extends = env:ttgo-t-display
upload_protocol = esptool

; Native simulation environment - runs ESP32 code on PC with mocked hardware
[env:native_sim]
platform = native
framework = arduino
build_flags = 
    -DNATIVE_SIMULATION=1
    -DSIMULATION_MODE=1
    -std=c++17
    -I./simulation/include
    -D__STDC_FORMAT_MACROS
    -DARDUINO=10813
    -DARDUINO_ARCH_NATIVE=1
    -DESP32=1
    -DBOARD_HAS_PSRAM=1
    -DARDUINO_TTGO_T_Display=1
    -DUSER_SETUP_LOADED=1
    -DST7789_DRIVER=1
    -DTFT_WIDTH=135
    -DTFT_HEIGHT=240
    -DSIMULATED_TEMPERATURE_SENSOR=1
    -DSIMULATED_HEATER=1
    -DSIMULATED_MOTOR=1
    -DSIMULATED_DISPLAY=1
    -DSIMULATED_WIFI=1
    -DSIMULATION_TIME_ACCELERATION=60

src_dir = .
src_filter = 
    +<*.ino>
    +<*.cpp>
    +<*.h>
    +<simulation/*.cpp>
    -<build/>
    -<data/>
    -<archive/>
    -<test/>
    -<.vscode/>

lib_deps = 
    bblanchon/ArduinoJson@^6.21.3
    # Native versions or mocks of ESP32 libraries will be created

debug_test = test_native_sim
test_filter = native_*
